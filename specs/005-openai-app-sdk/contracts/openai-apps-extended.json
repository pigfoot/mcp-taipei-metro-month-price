{"$schema": "https://openai.com/apps/schema/functions.json", "name": "taipei-metro-tpass-extended", "version": "2.0.0", "description": "TPASS monthly pass calculator for Taipei Metro with OpenAI Apps SDK widget support", "functions": [{"name": "calculateTPASSComparison", "description": "Calculate and compare TPASS monthly pass (NT$1,200 for 30 days) versus Taipei Metro regular fare with frequent rider discount (5%-15% based on trip count)", "parameters": {"type": "object", "properties": {"startDate": {"type": "string", "description": "Start date for TPASS validity period in YYYY-MM-DD format. If not provided, uses today's date."}, "oneWayFare": {"type": "number", "description": "One-way fare amount in New Taiwan Dollars (NTD). Default is 40 NTD if not specified.", "minimum": 1, "maximum": 200}, "tripsPerDay": {"type": "number", "description": "Number of trips per working day. Default is 2 (round trip) if not specified.", "minimum": 1, "maximum": 10}, "customWorkingDays": {"type": "number", "description": "Optional: Override the calculated working days with a custom value (0-30).", "minimum": 0, "maximum": 30}}, "required": []}, "returns": {"type": "object", "properties": {"success": {"type": "boolean", "description": "Whether the calculation completed successfully"}, "recommendation": {"type": "string", "enum": ["BUY_TPASS", "USE_REGULAR"], "description": "The recommended option based on cost comparison"}, "tpassCost": {"type": "number", "description": "Cost of TPASS monthly pass (always NT$1,200)"}, "regularCost": {"type": "number", "description": "Total cost using regular fare after applying frequent rider discount"}, "savings": {"type": "number", "description": "Amount saved in NTD by choosing the recommended option"}, "savingsPercentage": {"type": "number", "description": "Percentage saved by choosing the recommended option"}, "explanation": {"type": "string", "description": "Human-readable explanation of the calculation and recommendation"}, "calculationDetails": {"type": "object", "description": "Detailed breakdown of the calculation", "properties": {"workingDays": {"type": "number", "description": "Number of working days in the 30-day period"}, "totalTrips": {"type": "number", "description": "Total number of trips (workingDays Ã— tripsPerDay)"}, "discountRate": {"type": "number", "description": "Applied discount rate (0.05 for 5%, 0.10 for 10%, 0.15 for 15%)"}, "discountTier": {"type": "string", "description": "Which discount tier was applied based on trip count"}, "validityPeriod": {"type": "object", "properties": {"start": {"type": "string", "description": "Start date of the 30-day TPASS period"}, "end": {"type": "string", "description": "End date of the 30-day TPASS period"}}}, "crossMonthDetails": {"type": "object", "description": "Additional details for cross-month calculations", "properties": {"isCrossMonth": {"type": "boolean", "description": "Whether the calculation spans multiple months"}, "monthlyBreakdown": {"type": "array", "description": "Detailed breakdown by month if cross-month", "items": {"type": "object", "properties": {"month": {"type": "string", "description": "Month and year (e.g., 'October 2024')"}, "workingDays": {"type": "number", "description": "Working days in this month"}, "trips": {"type": "number", "description": "Trips in this month"}, "cost": {"type": "number", "description": "Cost for this month"}}}}}}}}}, "widget": {"type": "object", "description": "Widget configuration for displaying results", "properties": {"type": {"type": "string", "enum": ["result"], "description": "Widget type for calculation results"}, "layout": {"type": "string", "enum": ["vertical", "horizontal"], "default": "vertical", "description": "Layout orientation for the widget"}, "title": {"type": "string", "description": "Title for the result widget"}, "sections": {"type": "array", "description": "Visual sections in the widget", "items": {"type": "object", "properties": {"title": {"type": "string", "description": "Section title"}, "type": {"type": "string", "enum": ["summary", "details", "breakdown"]}, "content": {"type": "string", "description": "Section content"}}}}}, "actions": {"type": "array", "description": "Interactive actions available in the widget", "items": {"type": "object", "properties": {"type": {"type": "string", "enum": ["recalculate", "detailed_view", "share"]}, "label": {"type": "string", "description": "Button or action label"}, "description": {"type": "string", "description": "Description of what the action does"}}}}}}}}, {"name": "getDiscountInformation", "description": "Get detailed information about Taipei Metro frequent rider discount program and TPASS benefits", "parameters": {"type": "object", "properties": {}}, "returns": {"type": "object", "properties": {"success": {"type": "boolean", "description": "Whether the request completed successfully"}, "frequentRiderProgram": {"type": "object", "description": "Details about the frequent rider discount program", "properties": {"discountTiers": {"type": "array", "description": "List of discount tiers based on monthly trip count", "items": {"type": "object", "properties": {"tripRange": {"type": "string", "description": "Range of trips for this tier (e.g., '11-20 trips')"}, "discount": {"type": "string", "description": "Discount percentage (e.g., '5%')"}}}}, "resetCycle": {"type": "string", "description": "When the trip count resets (e.g., 'Monthly on the 1st')"}, "eligibility": {"type": "string", "description": "Who can use this discount program"}}}, "tpassProgram": {"type": "object", "description": "Details about the TPASS monthly pass", "properties": {"price": {"type": "string", "description": "Monthly pass price (e.g., 'NT$1,200')"}, "validity": {"type": "string", "description": "How long the pass is valid (e.g., '30 consecutive days')"}, "benefits": {"type": "array", "description": "List of TPASS benefits", "items": {"type": "string"}}, "coverage": {"type": "string", "description": "Which transportation systems are covered"}}}, "comparisonTip": {"type": "string", "description": "General advice on when TPASS is beneficial"}}, "widget": {"type": "object", "description": "Widget configuration for displaying discount information", "properties": {"type": {"type": "string", "enum": ["info"]}, "layout": {"type": "string", "enum": ["vertical", "grid"], "default": "vertical"}, "title": {"type": "string", "description": "Title for the information widget"}, "sections": {"type": "array", "description": "Information sections", "items": {"type": "object", "properties": {"title": {"type": "string", "description": "Section title"}, "type": {"type": "string", "enum": ["tiers", "benefits", "tips"]}, "content": {"type": "string", "description": "Section content"}}}}}}}}}, {"name": "startTpassCalculation", "description": "Start a step-by-step TPASS calculation with guided interaction", "parameters": {"type": "object", "properties": {"mode": {"type": "string", "enum": ["basic", "advanced"], "default": "basic", "description": "Calculation mode - basic or advanced"}}, "returns": {"type": "object", "properties": {"success": {"type": "boolean", "description": "Whether the interaction started successfully"}, "currentStep": {"type": "number", "description": "Current step number (1-based)"}, "totalSteps": {"type": "number", "description": "Total steps in the calculation flow"}, "stepTitle": {"type": "string", "description": "Title for the current step"}, "stepDescription": {"type": "string", "description": "Description of what to do in this step"}, "widget": {"type": "object", "description": "Widget for the current step", "properties": {"type": {"type": "string", "enum": ["form"]}, "layout": {"type": "string", "enum": ["vertical", "horizontal"], "default": "vertical"}, "title": {"type": "string", "description": "Form title"}, "fields": {"type": "array", "description": "Input fields for this step", "items": {"type": "object", "properties": {"name": {"type": "string", "description": "Field name"}, "type": {"type": "string", "enum": ["date-picker", "number-input", "dropdown", "text-input"]}, "label": {"type": "string", "description": "Field label"}, "description": {"type": "string", "description": "Field description"}, "required": {"type": "boolean", "default": false, "description": "Whether this field is required"}, "validation": {"type": "object", "description": "Validation rules for this field", "properties": {"min": {"type": "number", "description": "Minimum value for numeric fields"}, "max": {"type": "number", "description": "maximum value for numeric fields"}, "pattern": {"type": "string", "description": "Regex pattern for text fields"}}}}}}, "actions": {"type": "array", "description": "Actions available in the widget", "items": {"type": "object", "properties": {"type": {"type": "string", "enum": ["next", "cancel"]}, "label": {"type": "string", "description": "Action button label"}, "enabled": {"type": "boolean", "default": true, "description": "Whether the action is currently enabled"}}}}}}}}, {"name": "continueCalculation", "description": "Continue a step-by-step calculation with step data", "parameters": {"type": "object", "properties": {"step": {"type": "number", "description": "Step number being continued"}, "data": {"type": "object", "description": "Data collected from previous steps", "properties": {"startDate": {"type": "string", "description": "Start date from step 1"}, "oneWayFare": {"type": "number", "description": "Fare amount from step 1"}, "tripsPerDay": {"type": "number", "description": "Trips per day from step 2"}, "customWorkingDays": {"type": "number", "description": "Custom working days from step 2"}}}}}, "returns": {"type": "object", "properties": {"success": {"type": "boolean", "description": "Whether the step was processed successfully"}, "currentStep": {"type": "number", "description": "Current step number"}, "totalSteps": {"type": "number", "description": "Total steps in the flow"}, "isComplete": {"type": "boolean", "description": "Whether the calculation is complete"}, "calculationResult": {"type": "object", "description": "Final calculation result if complete", "properties": {"recommendation": {"type": "string", "enum": ["BUY_TPASS", "USE_REGULAR"]}, "tpassCost": {"type": "number"}, "regularCost": {"type": "number"}, "savings": {"type": "number"}, "explanation": {"type": "string"}}}, "nextWidget": {"type": "object", "description": "Widget for next step or completion"}}}}, {"name": "handleWidgetError", "description": "Handle errors in widget interactions with user-friendly guidance", "parameters": {"type": "object", "properties": {"errorType": {"type": "string", "enum": ["validation", "calculation", "network", "widget"], "description": "Type of error that occurred"}, "errorMessage": {"type": "string", "description": "Detailed error message"}, "context": {"type": "object", "description": "Context where error occurred", "properties": {"step": {"type": "number", "description": "Step number where error occurred"}, "field": {"type": "string", "description": "Field that caused the error"}}}}}, "returns": {"type": "object", "properties": {"success": {"type": "boolean", "description": "Whether error was handled successfully"}, "errorWidget": {"type": "object", "description": "Widget to display error information", "properties": {"type": {"type": "string", "enum": ["error"]}, "title": {"type": "string", "description": "Error title"}, "message": {"type": "string", "description": "User-friendly error message"}, "suggestions": {"type": "array", "description": "Suggestions for fixing the error", "items": {"type": "string"}}, "actions": {"type": "array", "description": "Actions user can take", "items": {"type": "object", "properties": {"type": {"type": "string", "enum": ["retry", "cancel", "help"]}, "label": {"type": "string", "description": "Action button label"}}}}}}}}}]}}
}
